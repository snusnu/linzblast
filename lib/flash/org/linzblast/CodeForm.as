package  {	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.display.Loader;  import flash.text.TextField;  import flash.text.TextFieldAutoSize;  import flash.text.TextFormat;	import flash.net.*;	import flash.events.*;		// as3corelib json include	import com.adobe.serialization.json.*; 		public class CodeForm extends MovieClip {	  	  private var gameStage:Game = null;	  	  public function CodeForm(gameStage:Game) {	    this.gameStage = gameStage;	    this.codeSubmitButton.addEventListener(MouseEvent.CLICK, submitCode);	  }	  	  // private helpers	  	  private function submitCode(event:Event) {	    	    // setup the request			var request:URLRequest = new URLRequest("/games.json");			request.contentType = "application/json"; 			request.method = URLRequestMethod.POST;			request.data = JSON.encode(this.postData());			var loader:URLLoader = new URLLoader();						// add listener that changes the gameStage			loader.addEventListener(Event.COMPLETE, setCurrentGameInfo);			loader.addEventListener(IOErrorEvent.IO_ERROR, setCurrentGameInfo);			loader.load(request);		}				// build the post body content		private function postData() {		  var postData:Object = new Object();			postData.game = new Object();			postData.game.code = codeInput.text;			postData.game.wall_id = gameStage.currentWallData.id;			postData._method = "POST";			return postData;		}				// change current game info in gameStage		private function setCurrentGameInfo(event:Event) {		  if (event is IOErrorEvent) {        trace("Unauthenticated");      } else {		    var gameInfo:Object = JSON.decode(URLLoader(event.target).data);  		  this.gameStage.gameId           = gameInfo.id;  		  this.gameStage.currentWallData  = gameInfo.wall;        this.gameStage.currentStyleData = gameInfo.available_styles[0];        this.gameStage.start(codeInput.text);      }		}	}}